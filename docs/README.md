# COMBINE_LLM 项目文档导航

## 📚 文档概览

欢迎来到COMBINE_LLM项目的文档中心。本目录包含了系统的完整技术文档。

---

## 🗂️ 文档目录

### 核心设计文档

| 序号 | 文档名称 | 文档类型 | 适用读者 | 说明 |
|-----|---------|----------|---------|------|
| **01** | [架构设计文档](./01-架构设计文档.md) | 战略性 | 架构师、技术负责人、全体开发 | 系统如何组织、模块划分、技术选型 |
| **02** | [详细设计文档](./02-详细设计文档.md) | 战术性 | 开发工程师 | 类定义、方法实现、算法流程 |
| **03** | [数据库设计文档](./03-数据库设计文档.md) | 技术性 | 后端开发、DBA | ES、Neo4j、MySQL、Redis设计 |

### 项目文档（根目录）

| 文档名称 | 位置 | 说明 |
|---------|------|------|
| [需求文档.md](../需求文档.md) | 项目根目录 | 业务需求、功能需求、非功能需求 |
| [架构设计文档](../架构设计文档) | 项目根目录 | 原有架构设计（已有重构版） |

---

## 📖 阅读顺序建议

### 对于新加入的开发人员

1. **第一步**：阅读[需求文档.md](../需求文档.md)，了解系统要做什么
2. **第二步**：阅读[01-架构设计文档.md](./01-架构设计文档.md)，理解系统如何组织
3. **第三步**：阅读[03-数据库设计文档.md](./03-数据库设计文档.md)，了解数据如何存储
4. **第四步**：阅读[02-详细设计文档.md](./02-详细设计文档.md)，学习具体实现

### 对于架构师/技术负责人

1. [需求文档.md](../需求文档.md) - 业务需求
2. [01-架构设计文档.md](./01-架构设计文档.md) - 架构设计决策
3. [03-数据库设计文档.md](./03-数据库设计文档.md) - 数据架构

### 对于前端开发人员

1. [需求文档.md](../需求文档.md) - 了解业务
2. [01-架构设计文档.md](./01-架构设计文档.md) - 第6节（数据流设计）
3. ~~04-API接口文档.md~~ (待编写) - API接口规范

---

## 🎯 各文档详细说明

### 01-架构设计文档.md

**回答的问题**：系统该如何组织？

**核心内容**：
- ✅ 系统分层架构（API层、应用服务层、领域逻辑层、基础设施层）
- ✅ 核心模块划分（意图解析、知识检索、提示词构建等）
- ✅ 技术选型及理由（FastAPI、Pydantic、loguru等）
- ✅ 数据流设计（三种查询模式：ES/Neo4j/混合）
- ✅ 部署架构（服务拓扑、扩展性设计）
- ✅ 实施路线图（5个阶段的重构计划）

**重点章节**：
- 第3节：系统分层架构（必读）
- 第4节：核心模块划分（必读）
- 第6节：数据流设计（理解系统运行）
- 第8节：实施路线图（了解重构计划）

---

### 02-详细设计文档.md

**回答的问题**：每个模块如何实现？

**核心内容**：
- ✅ 领域模型设计（Intent、Knowledge、Message、Session）
- ✅ API层详细设计（请求/响应Schema、路由定义）
- ✅ 应用服务层详细设计（ChatService、SessionService）
- ✅ 领域逻辑层详细设计（IntentParser、Retriever、PromptBuilder）
- ✅ 基础设施层详细设计（LLMClient、Repository模式）
- ✅ 配置管理详细设计（Pydantic Settings）
- ✅ 日志与监控详细设计（loguru配置、Prometheus指标）
- ✅ 关键时序图（ES查询流程时序）

**重点章节**：
- 第1节：领域模型设计（理解数据结构）
- 第4节：领域逻辑层详细设计（核心业务逻辑）
- 第5节：基础设施层详细设计（外部系统交互）

**代码示例**：
文档中包含了大量可直接参考的代码示例，包括：
- BaseIntentParser基类定义
- ESIntentParser实现
- ESRetriever实现
- LLMClient实现
- MessageRepository实现

---

### 03-数据库设计文档.md

**回答的问题**：数据如何存储和流转？

**核心内容**：
- ✅ 数据库总览（4个数据库的角色分工）
- ✅ Elasticsearch设计（3个索引：kb_vector_store、conversation_history、user_memory）
- ✅ Neo4j设计（图模型、节点类型、关系类型、Cypher查询）
- ✅ MySQL设计（users表、sessions表）
- ✅ Redis设计（会话元数据Hash、会话消息List）
- ✅ 数据流转与同步（创建会话、流式对话、数据一致性）
- ✅ 性能优化建议（ES、Neo4j、MySQL、Redis优化）

**重点章节**：
- 第1节：数据库总览（必读，理解整体架构）
- 第2节：Elasticsearch设计（核心检索引擎）
- 第6节：数据流转与同步（理解数据如何流转）

**关键设计**：
- **双层存储架构**：Redis缓存 + ES持久化
- **三库同步**：MySQL（事实来源） → Redis（快速访问） → ES（检索分析）
- **数据一致性**：强一致性 vs 最终一致性的权衡

---

## 🔍 快速查找

### 按功能模块查找

| 功能模块 | 相关文档章节 |
|---------|------------|
| **意图解析** | 架构设计-4.3 / 详细设计-4.1 |
| **知识检索** | 架构设计-4.3 / 详细设计-4.2 / 数据库设计-2.2.1 |
| **会话管理** | 架构设计-4.2 / 详细设计-3.1 / 数据库设计-4.2.2 |
| **流式响应** | 架构设计-6.1 / 详细设计-3.1 |
| **配置管理** | 架构设计-7 / 详细设计-6 |
| **日志监控** | 架构设计-8 / 详细设计-7 |

### 按技术栈查找

| 技术 | 相关文档章节 |
|-----|------------|
| **FastAPI** | 架构设计-5.1 / 详细设计-2 |
| **Pydantic** | 架构设计-5.1 / 详细设计-6.1 |
| **Elasticsearch** | 架构设计-5.2 / 数据库设计-2 |
| **Neo4j** | 架构设计-5.2 / 数据库设计-3 |
| **MySQL** | 架构设计-5.2 / 数据库设计-4 |
| **Redis** | 架构设计-5.2 / 数据库设计-5 |
| **LangChain/Langfuse** | 详细设计-5.1 |

---

## 📝 文档约定

### 文档格式约定

- **标题层级**：最多使用4级标题（# ## ### ####）
- **代码块**：使用```语法，指定语言类型（python/sql/bash/json等）
- **表格**：使用Markdown表格，表头加粗
- **链接**：文档内链接使用相对路径

### 术语约定

| 术语 | 说明 |
|-----|------|
| **模块** | 代码组织的逻辑单元（如意图解析模块） |
| **层** | 架构分层（API层、应用服务层等） |
| **服务** | 提供特定功能的类（如ChatService） |
| **客户端** | 与外部系统交互的封装（如LLMClient） |
| **仓储** | 数据访问层（如MessageRepository） |
| **意图** | 用户查询的解析结果（Intent对象） |
| **检索** | 从知识库获取相关知识的过程 |

---

## 🔧 文档维护

### 文档更新规则

1. **重大架构变更**：必须更新架构设计文档
2. **新增API接口**：必须更新API接口文档
3. **数据库schema变更**：必须更新数据库设计文档
4. **类/方法变更**：建议更新详细设计文档

### 文档审批流程

```
开发人员编写/修改文档
        ↓
    技术负责人审核
        ↓
    架构师最终审批
        ↓
      合并到主分支
```

### 文档版本控制

所有文档均使用Git版本控制，重要变更需在文档末尾的"文档变更记录"中说明。

---

## ❓ FAQ

### Q1: 为什么要拆分架构设计和详细设计？

**A**:
- **架构设计**关注"系统如何组织"的战略问题，适合架构师和技术负责人阅读
- **详细设计**关注"如何实现"的战术问题，适合开发工程师编码参考
- 分离后各文档更聚焦，降低认知负担

### Q2: 新人应该先看哪个文档？

**A**:
1. 先看需求文档（了解业务）
2. 再看架构设计文档（理解系统）
3. 最后看详细设计文档（学习实现）

### Q3: 文档和代码不一致怎么办？

**A**:
- **原则**：以代码为准
- **行动**：发现不一致后应及时更新文档
- **预防**：代码变更时同步更新文档

### Q4: 如何快速找到某个功能的实现？

**A**:
1. 在本README中查找"按功能模块查找"表格
2. 跳转到对应文档章节
3. 查看类定义和代码示例

---

## 📬 反馈与建议

如果您在阅读文档过程中发现问题或有改进建议，请：
1. 在项目中提Issue
2. 或直接联系文档维护人员

---

## 📄 许可证

本项目文档遵循与项目代码相同的许可证。

---

**最后更新**：2025-12-18
**文档维护人**：架构组
**文档状态**：✅ 已审批
