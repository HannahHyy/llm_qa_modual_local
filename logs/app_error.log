现在es检索正常了，但是neo4j检索不出结果，之前的old里面的代码是可以检索出图数据库的结果的，请认真分析，是不是模型、json提取、提示词配置等等有问题：
2025-12-26 16:39:21 | INFO     | api.middleware.logging_middleware:dispatch:49 | 请求完成: [1766738360959] GET /api/sessions/ status=200 time=507.93ms 
INFO:     127.0.0.1:63441 - "GET /api/sessions/?user_id=111111 HTTP/1.1" 200 OK
2025-12-26 16:39:24 | INFO     | api.middleware.logging_middleware:dispatch:33 | 请求开始: [1766738364541] POST /api/chat/stream client=127.0.0.1
2025-12-26 16:39:25 | INFO     | infrastructure.clients.llm_client:__init__:58 | LLM客户端初始化成功: https://dashscope.aliyuncs.com/compatible-mode/v1, model=deepseek-v3
2025-12-26 16:39:26 | INFO     | infrastructure.clients.neo4j_client:connect:45 | Neo4j连接成功: bolt://localhost:7687
2025-12-26 16:39:26 | INFO     | api.middleware.logging_middleware:dispatch:49 | 请求完成: [1766738364541] POST /api/chat/stream status=200 time=1556.92ms
INFO:     127.0.0.1:63441 - "POST /api/chat/stream?session_id=62e7f377-1b5d-437c-8d4f-a26709e45770&user_id=111111 HTTP/1.1" 200 OK
2025-12-26 16:39:26 | INFO     | infrastructure.repositories.message_repository:_get_messages_from_es:127 | [ES] 获取消息成功: count=0
2025-12-26 16:39:26 | INFO     | domain.strategies.llm_intent_router:route:125 | [LLM路由] 第1次尝试...
2025-12-26 16:39:30 | INFO     | domain.strategies.llm_intent_router:route:158 | [LLM路由] 决策: hybrid, 理由: 当前用户查询包含两个部分：第一部分‘河北 单位建设了哪些网络’涉及具体的业务实体信息，需要从neo4j中获取该单位的网络架构数据；第二部分‘等保三级网络建设要求是什么’涉及网络安全等级保护的法规标准， 需从es中检索相关条款。由于问题同时涉及具体业务数据和法规要求，且可能存在将河北单位实际建设情况与等保三级要求进行对照分析的需求，因此需要结合两个知识库 的信息进行回答，适合选择hybrid模式。
2025-12-26 16:39:40 | INFO     | domain.services.neo4j_query_service:extract:40 | [JSON提取DEBUG] 提取到JSON部分长度: 75
2025-12-26 16:39:40 | INFO     | domain.services.neo4j_query_service:extract:41 | [JSON提取DEBUG] JSON前100字符: [{"intent_item": "查询河北省内的单位所建设的网络"}, {"intent_item": "获取等保三级网络建设的技术与管理要求"}]
2025-12-26 16:39:40 | INFO     | domain.services.neo4j_query_service:extract:51 | [JSON提取DEBUG] 匹配到JSON字符串长度: 75
2025-12-26 16:39:40 | INFO     | domain.services.neo4j_query_service:extract:52 | [JSON提取DEBUG] JSON字符串: [{"intent_item": "查询河北省内的单位所建 设的网络"}, {"intent_item": "获取等保三级网络建设的技术与管理要求"}]...
2025-12-26 16:39:40 | INFO     | domain.services.neo4j_query_service:query_stream:506 | [Neo4j查询] 意图识别结果: [{'intent_item': '查询河北省内的单位 所建设的网络'}, {'intent_item': '获取等保三级网络建设的技术与管理要求'}]
2025-12-26 16:39:41 | INFO     | domain.services.neo4j_query_service:_match_examples_from_es:277 | [Neo4j示例匹配] 为意图'查询河北省内的单位所建设的网 络'匹配到 1 个示例
2025-12-26 16:39:41 | INFO     | domain.services.neo4j_query_service:query_stream:526 | [Neo4j查询] 意图: 查询河北省内的单位所建设的网络, 匹配示例数: 1
2025-12-26 16:39:41 | INFO     | domain.services.neo4j_query_service:_match_examples_from_es:277 | [Neo4j示例匹配] 为意图'获取等保三级网络建设的技术与 管理要求'匹配到 1 个示例
2025-12-26 16:39:41 | INFO     | domain.services.neo4j_query_service:query_stream:526 | [Neo4j查询] 意图: 获取等保三级网络建设的技术与管理要求, 匹配示 例数: 1
2025-12-26 16:39:49 | INFO     | domain.services.neo4j_query_service:_generate_cyphers_batch_with_stream:375 | [Neo4j Cypher生成] LLM输出: 分析思路：

1. 意图1：查询河北省内的单位所建设的网络  
   - 根据示例和数据库结构，应匹配“单位”节点（:Unit）与“网络”节点（:Netname 或 :网络），通过关系 [:拥有] 连接（参考实际关系类型为“拥有”，起始节点为单位 -> 网络）
   - 单位名称中包含“河北”即可匹配
   - 返回网络的相关属性：netId（可能对应 name）、networkType（对应 type）、netName（可读名称）
   - 注意：示例中使用了别名 `n:Netname`，但根据数据库结构定义的是“网络”节点类型，且属性为 name, type, ip_range。因此应使用正确的标签和属性。
   - 正确做法是使用 `:网络` 节点，并返回其属性，如 name 作为 netName，type 作为 networkType，可将 name 映射为 netId 或直接返回。

2. 意图2：获取等保三级网络建设的技术与管理要求  
   - 该问题属于政策/标准类问题，不涉及图数据库中的实体查询
   - 图数据库结构中无“等保要求”、“等级保护”、“技术要求”等相关...
2025-12-26 16:39:49 | INFO     | domain.services.neo4j_query_service:extract:40 | [JSON提取DEBUG] 提取到JSON部分长度: 221
2025-12-26 16:39:49 | INFO     | domain.services.neo4j_query_service:extract:41 | [JSON提取DEBUG] JSON前100字符: [{"intent_item": "查询河北省内的单位所建设的网络", "cypher": "MATCH (u:单位)-[:拥有]->(n:网络) WHERE u.name CONTAINS '河北'
2025-12-26 16:39:49 | INFO     | domain.services.neo4j_query_service:extract:51 | [JSON提取DEBUG] 匹配到JSON字符串长度: 65
2025-12-26 16:39:49 | INFO     | domain.services.neo4j_query_service:extract:52 | [JSON提取DEBUG] JSON字符串: [{"intent_item": "查询河北省内的单位所建 设的网络", "cypher": "MATCH (u:单位)-[:拥有]...
2025-12-26 16:39:49 | WARNING  | domain.services.neo4j_query_service:extract:65 | [JSON提取] JSON解析失败: Unterminated string starting at: line 1 column 47 (char 46)
2025-12-26 16:39:49 | WARNING  | domain.services.neo4j_query_service:extract:66 | [JSON提取] 尝试解析的文本前500字符: 分析思路：

1. 意图1：查询河北省内的单位所建设的网络  
   - 根据示例和数据库结构，应匹配“单位”节点（:Unit）与“网络”节点（:Netname 或 :网络），通过关系 [:拥有] 连接（参考实际关系类型为“拥有”，起始节点为单位 -> 网络）
   - 单位名称中包含“河北”即可匹配
   - 返回网络的相关属性：netId（可能对应 name）、networkType（对应 type）、netName（可读名称）
   - 注意：示例中使用了别名 `n:Netname`，但根据数据库结构定义的是“网络”节点类型，且属性为 name, type, ip_range。因此应使用正确的标签和属性。
   - 正确做法是使用 `:网络` 节点，并返回其属性，如 name 作为 netName，type 作为 networkType，可将 name 映射为 netId 或直接返回。

2. 意图2：获取等保三级网络建设的技术与管理要求  
   - 该问题属于政策/标准类问题，不涉及图数据库中的实体查询
   - 图数据库结构中无“等保要求”、“等级保护”、“技术要求”等相关
2025-12-26 16:39:49 | WARNING  | domain.services.neo4j_query_service:_generate_cyphers_batch_with_stream:380 | [Neo4j Cypher生成] 未解析到结果
2025-12-26 16:40:15 | INFO     | domain.services.es_query_service:_search_single_intent:417 | [ES检索DEBUG] 意图1
2025-12-26 16:40:15 | INFO     | domain.services.es_query_service:_search_single_intent:418 | [ES检索DEBUG] 查询文本: 河北单位建设了哪些网络?等保三级网络建设要求是什么？ 河北省相关单位网络建设情况具体信息
2025-12-26 16:40:15 | INFO     | domain.services.es_query_service:_search_single_intent:419 | [ES检索DEBUG] 过滤条件数: 0 (仅标准过滤)
2025-12-26 16:40:15 | INFO     | domain.services.es_query_service:_search_single_intent:420 | [ES检索DEBUG] regulation_standards: []
2025-12-26 16:40:15 | INFO     | domain.services.es_query_service:_search_single_intent:421 | [ES检索DEBUG] source_standard: []
2025-12-26 16:40:15 | INFO     | domain.services.es_query_service:_search_single_intent:422 | [ES检索DEBUG] applicability_level (BM25打分用): []       
2025-12-26 16:40:15 | INFO     | domain.services.es_query_service:_search_single_intent:423 | [ES检索DEBUG] requirement_items (BM25打分用): []
2025-12-26 16:40:16 | INFO     | domain.services.es_query_service:_search_single_intent:454 | [ES检索] 意图1 BM25检索到 494 条结果
2025-12-26 16:40:16 | INFO     | domain.services.es_query_service:_search_single_intent:417 | [ES检索DEBUG] 意图2
2025-12-26 16:40:16 | INFO     | domain.services.es_query_service:_search_single_intent:418 | [ES检索DEBUG] 查询文本: 河北单位建设了哪些网络?等保三级网络建设要求是什么？ 网络安全等级保护三级 网络架构建设 技术要求 管理规范
2025-12-26 16:40:16 | INFO     | domain.services.es_query_service:_search_single_intent:419 | [ES检索DEBUG] 过滤条件数: 1 (仅标准过滤)
2025-12-26 16:40:16 | INFO     | domain.services.es_query_service:_search_single_intent:420 | [ES检索DEBUG] regulation_standards: ['信息安全技术 网络安全等级保护基本要求']
2025-12-26 16:40:16 | INFO     | domain.services.es_query_service:_search_single_intent:421 | [ES检索DEBUG] source_standard: ['GB/T 22239-2019']       
2025-12-26 16:40:16 | INFO     | domain.services.es_query_service:_search_single_intent:422 | [ES检索DEBUG] applicability_level (BM25打分用): ['等保三 级']
2025-12-26 16:40:16 | INFO     | domain.services.es_query_service:_search_single_intent:423 | [ES检索DEBUG] requirement_items (BM25打分用): ['网络建设 要求']
2025-12-26 16:40:16 | INFO     | domain.services.es_query_service:_search_single_intent:454 | [ES检索] 意图2 BM25检索到 0 条结果
2025-12-26 16:40:41 | INFO     | infrastructure.repositories.message_repository:append_message:164 | [Redis] 消息追加成功: role=user
2025-12-26 16:40:41 | INFO     | infrastructure.repositories.message_repository:append_message:186 | [ES] 消息索引成功: message_id=msg_62e7f377-1b5d-437c-8d4f-a26709e45770_1766709641031
2025-12-26 16:40:41 | INFO     | infrastructure.repositories.message_repository:append_message:164 | [Redis] 消息追加成功: role=assistant
2025-12-26 16:40:41 | INFO     | infrastructure.repositories.message_repository:append_message:186 | [ES] 消息索引成功: message_id=msg_62e7f377-1b5d-437c-8d4f-a26709e45770_1766709641077
2025-12-26 16:41:02 | INFO     | api.middleware.logging_middleware:dispatch:33 | 请求开始: [1766738462383] POST /api/chat/stream client=127.0.0.1
2025-12-26 16:41:02 | INFO     | api.middleware.logging_middleware:dispatch:49 | 请求完成: [1766738462383] POST /api/chat/stream status=200 time=2.95ms
INFO:     127.0.0.1:63449 - "POST /api/chat/stream?session_id=62e7f377-1b5d-437c-8d4f-a26709e45770&user_id=111111 HTTP/1.1" 200 OK
2025-12-26 16:41:02 | INFO     | infrastructure.repositories.message_repository:get_messages:74 | [Redis] 获取消息成功: count=2
2025-12-26 16:41:02 | INFO     | domain.strategies.llm_intent_router:route:125 | [LLM路由] 第1次尝试...
2025-12-26 16:41:08 | INFO     | domain.strategies.llm_intent_router:route:158 | [LLM路由] 决策: neo4j, 理由: 当前查询为‘河北单位建设了哪些网络？’，该 问题聚焦于特定单位（河北单位）的网络建设情况，属于具体的业务实体信息查询。根据知识库数据源说明，此类涉及具体单位、网络、系统等实际部署情况的问题应由neo4j业务图谱库提供支持。虽然历史对话中已尝试检索但未返回结果，但这不影响对当前查询意图的本质判断——仍需依赖业务数据存储进行回答。因此，决策为使用neo4j数据源。
2025-12-26 16:41:16 | INFO     | domain.services.neo4j_query_service:extract:40 | [JSON提取DEBUG] 提取到JSON部分长度: 39
2025-12-26 16:41:16 | INFO     | domain.services.neo4j_query_service:extract:41 | [JSON提取DEBUG] JSON前100字符: [{"intent_item": "查找由河北省内的单位所建设的所有网络"}]
2025-12-26 16:41:16 | INFO     | domain.services.neo4j_query_service:extract:51 | [JSON提取DEBUG] 匹配到JSON字符串长度: 39
2025-12-26 16:41:16 | INFO     | domain.services.neo4j_query_service:extract:52 | [JSON提取DEBUG] JSON字符串: [{"intent_item": "查找由河北省内的单位所 建设的所有网络"}]...
2025-12-26 16:41:16 | INFO     | domain.services.neo4j_query_service:query_stream:506 | [Neo4j查询] 意图识别结果: [{'intent_item': '查找由河北省内的单 位所建设的所有网络'}]
2025-12-26 16:41:16 | INFO     | domain.services.neo4j_query_service:_match_examples_from_es:277 | [Neo4j示例匹配] 为意图'查找由河北省内的单位所建设的 所有网络'匹配到 1 个示例
2025-12-26 16:41:16 | INFO     | domain.services.neo4j_query_service:query_stream:526 | [Neo4j查询] 意图: 查找由河北省内的单位所建设的所有网络, 匹配示 例数: 1
2025-12-26 16:41:29 | INFO     | domain.services.neo4j_query_service:_generate_cyphers_batch_with_stream:375 | [Neo4j Cypher生成] LLM输出: 分析思路：

- 用户问题：“河北单位建设了哪些网络？” 意图是查找由河北省内的单位所建设的网络。
- 根据提供的示例，关系 `UNIT_NET` 表示单位与网络之间的关联，尽管该关系未在“Neo4j图数据库结构”中明确定义，但示例中使用了 `(u:Unit)-[:UNIT_NET]->(n:Netname)`，说明在实际图模型中存在此关系。
- 节点类型：`Unit` 和 `Netname`（注意：示例中为 `Netname`，但“图结构”中定义为 `网络` 节点，属性为 `name`，推测 `Netname` 即对应 `网络` 节点）。        
- 属性匹配方式：使用 `CONTAINS` 进行模糊匹配，如 `u.name CONTAINS "河北"` 来筛选河北省的单位。
- 返回内容：网络的 ID、类型、名称等属性。但由于“网络”节点属性中没有 `netId` 或 `networkType`，只有 `name`, `type`, `ip_range`，需参考示例调整字段别名。

根据提示：**严禁使用未定义的属性或关系**，但示例中出现了 `[:UNIT_NET]` 和 `Netnam...
2025-12-26 16:41:29 | INFO     | domain.services.neo4j_query_service:extract:40 | [JSON提取DEBUG] 提取到JSON部分长度: 200
2025-12-26 16:41:29 | INFO     | domain.services.neo4j_query_service:extract:41 | [JSON提取DEBUG] JSON前100字符: [
  {
    "intent_item": "查找由河北省内的单位所建设的所有网络",
    "cypher": "MATCH (u:Unit)-[:UNIT_NET]->(n:Netname
2025-12-26 16:41:29 | INFO     | domain.services.neo4j_query_service:extract:51 | [JSON提取DEBUG] 匹配到JSON字符串长度: 88
2025-12-26 16:41:29 | INFO     | domain.services.neo4j_query_service:extract:52 | [JSON提取DEBUG] JSON字符串: [
  {
    "intent_item": "查找由河北省内的单位所建设的所有网络",
    "cypher": "MATCH (u:Unit)-[:UNIT_NET]...
2025-12-26 16:41:29 | WARNING  | domain.services.neo4j_query_service:extract:65 | [JSON提取] JSON解析失败: Unterminated string starting at: line 4 column 15 (char 61)
2025-12-26 16:41:29 | WARNING  | domain.services.neo4j_query_service:extract:66 | [JSON提取] 尝试解析的文本前500字符: 分析思路：

- 用户问题：“河北单位建设了哪些网络？” 意图是查找由河北省内的单位所建设的网络。
- 根据提供的示例，关系 `UNIT_NET` 表示单位与网络之间的关联，尽管该关系未在“Neo4j图数据库结构”中明确定义，但示例中使用了 `(u:Unit)-[:UNIT_NET]->(n:Netname)`，说明在实际图模型中存在此关系。
- 节点类型：`Unit` 和 `Netname`（注意：示例中为 `Netname`，但“图结构”中定义为 `网络` 节点，属性为 `name`，推测 `Netname` 即对应 `网络` 节点）。        
- 属性匹配方式：使用 `CONTAINS` 进行模糊匹配，如 `u.name CONTAINS "河北"` 来筛选河北省的单位。
- 返回内容：网络的 ID、类型、名称等属性。但由于“网络”节点属性中没有 `netId` 或 `networkType`，只有 `name`, `type`, `ip_range`，需参考示例调整字段别名。

根据提示：**严禁使用未定义的属性或关系**，但示例中出现了 `[:UNIT_NET]` 和 `Netnam
2025-12-26 16:41:29 | WARNING  | domain.services.neo4j_query_service:_generate_cyphers_batch_with_stream:380 | [Neo4j Cypher生成] 未解析到结果
2025-12-26 16:41:32 | INFO     | infrastructure.repositories.message_repository:append_message:164 | [Redis] 消息追加成功: role=user
2025-12-26 16:41:32 | INFO     | infrastructure.repositories.message_repository:append_message:186 | [ES] 消息索引成功: message_id=msg_62e7f377-1b5d-437c-8d4f-a26709e45770_1766709692555
2025-12-26 16:41:32 | INFO     | infrastructure.repositories.message_repository:append_message:164 | [Redis] 消息追加成功: role=assistant
2025-12-26 16:41:32 | INFO     | infrastructure.repositories.message_repository:append_message:186 | [ES] 消息索引成功: message_id=msg_62e7f377-1b5d-437c-8d4f-a26709e45770_1766709692584